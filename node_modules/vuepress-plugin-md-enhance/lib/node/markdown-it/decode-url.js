"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
/***************************************************
 * Created by nanyuantingfeng on 2020/3/1 10:10. *
 ***************************************************/
const mdurl_1 = require("mdurl");
const needDecode = (url, config) => config === "./" || config === "."
    ? !/^(\w+?:\/)?\//u.test(url)
    : config instanceof RegExp
        ? config.test(url)
        : Array.isArray(config)
            ? config.some((a) => url.startsWith(a))
            : true;
const urlDecode = (url, config) => {
    const realURL = needDecode(url, config) ? mdurl_1.decode(url) : url;
    return /^(\w+?:\/)?\.?\//.test(realURL) ? realURL : `./${realURL}`;
};
const decodeURL = (md, config = "*") => {
    md.renderer.rules.image = (tokens, idx) => {
        const token = tokens[idx];
        return `<img src="${urlDecode(
        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion
        token.attrs[token.attrIndex("src")][1], config)}" alt="${md.utils.escapeHtml(token.content)}" />`;
    };
};
exports.default = decodeURL;
//# sourceMappingURL=decode-url.js.map