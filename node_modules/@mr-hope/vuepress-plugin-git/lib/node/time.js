"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.defaultTransformer = exports.getUpdatedTimeStamp = exports.getCreatedTimeStamp = void 0;
const path_1 = require("path");
const execa = require("execa");
const dayjs = require("dayjs");
const localizedFormat = require("dayjs/plugin/localizedFormat");
const utc = require("dayjs/plugin/utc"); // dependent on utc plugin
const timezone = require("dayjs/plugin/timezone");
require("dayjs/locale/en");
require("dayjs/locale/zh");
require("dayjs/locale/zh-cn");
dayjs.extend(localizedFormat);
dayjs.extend(utc);
dayjs.extend(timezone);
const getLang = (lang) => {
    const langcode = lang.toLowerCase();
    return langcode === "en-us" || langcode === "en-uk" ? "en" : langcode;
};
/**
 * Get unix timestamp in milliseconds of the first commit
 */
const getCreatedTimeStamp = async (filePath) => {
    const { stdout } = await execa("git", [
        "--no-pager",
        "log",
        "--diff-filter=A",
        "--format=%at",
        path_1.basename(filePath),
    ], { cwd: path_1.dirname(filePath) });
    return Number.parseInt(stdout, 10) * 1000;
};
exports.getCreatedTimeStamp = getCreatedTimeStamp;
/**
 * Get unix timestamp in milliseconds of the last commit
 */
const getUpdatedTimeStamp = async (filePath) => {
    const { stdout } = await execa("git", ["--no-pager", "log", "-1", "--format=%at", path_1.basename(filePath)], { cwd: path_1.dirname(filePath) });
    return Number.parseInt(stdout, 10) * 1000;
};
exports.getUpdatedTimeStamp = getUpdatedTimeStamp;
const defaultTransformer = (timestamp, lang, timezone) => {
    dayjs.locale(getLang(lang));
    return timezone
        ? `${dayjs(timestamp).tz(timezone).format("LL")} ${dayjs(timestamp)
            .tz(timezone)
            .format("HH:mm")}`
        : `${dayjs(timestamp).format("LL")} ${dayjs(timestamp).format("HH:mm")}`;
};
exports.defaultTransformer = defaultTransformer;
//# sourceMappingURL=time.js.map