(window.webpackJsonp=window.webpackJsonp||[]).push([[28],{860:function(s,t,a){"use strict";a.r(t);var e=a(1),n=Object(e.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("details",{staticClass:"custom-block details"},[a("summary",[s._v("参考")]),s._v(" "),a("ol",[a("li",[a("a",{attrs:{href:"https://www.modb.pro/db/116651",target:"_blank",rel:"noopener noreferrer"}},[s._v("Linux系统安全隐患及加强安全管理的方法"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://cloud.tencent.com/developer/article/1670754",target:"_blank",rel:"noopener noreferrer"}},[s._v("14个Linux系统安全小妙招，总有一招用的上"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://www.linuxquestions.org/questions/linux-newbie-8/what-is-the-systemd-equivalent-of-chkconfig-list-4175547184/",target:"_blank",rel:"noopener noreferrer"}},[s._v("[SOLVED] What is the systemd equivalent of chkconfig --list?"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://www.jianshu.com/p/a4defcfe17f9",target:"_blank",rel:"noopener noreferrer"}},[s._v("禁止Linux用户远程登录"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://www.jianshu.com/p/0731a082f054",target:"_blank",rel:"noopener noreferrer"}},[s._v("Linux系统安全设置整理"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://www.361way.com/linux-permit-su/5745.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("Linux允许部分用户su"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://access.redhat.com/solutions/64860",target:"_blank",rel:"noopener noreferrer"}},[s._v("Permitting or Restricting a User's su Access to Privileged Accounts"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://computingforgeeks.com/restrict-su-access-to-privileged-accounts-linux/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Restrict su access to Privileged Accounts in Linux"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://blog.51cto.com/jasonyong/164005",target:"_blank",rel:"noopener noreferrer"}},[s._v("pam_succeed_if的使用（四）"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://linux.die.net/man/8/pam_succeed_if",target:"_blank",rel:"noopener noreferrer"}},[s._v("pam_succeed_if(8) - Linux man page"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://www.docs4dev.com/docs/zh/linux-pam/1.1.2/reference/sag-pam_succeed_if.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("6.31. pam_succeed_if-测试帐户 Feature"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://man7.org/linux/man-pages/man8/pam_succeed_if.8.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("pam_succeed_if(8) — Linux manual page"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://blog.csdn.net/qq_29277155/article/details/84943631",target:"_blank",rel:"noopener noreferrer"}},[s._v("linux杀毒软件 - CSDN"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://blog.csdn.net/xianjie0318/article/details/107315413",target:"_blank",rel:"noopener noreferrer"}},[s._v("应急响应--linux病毒查杀工具ClamAV"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://www.ultimate-communications.com/zh/system_69433",target:"_blank",rel:"noopener noreferrer"}},[s._v("linux病毒查杀"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://blog.51cto.com/moerjinrong/2340089",target:"_blank",rel:"noopener noreferrer"}},[s._v("Linux 病毒检测"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://segmentfault.com/a/1190000019292140",target:"_blank",rel:"noopener noreferrer"}},[s._v("深入浅出TCP中的SYN-Cookies"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://segmentfault.com/a/1190000019252960",target:"_blank",rel:"noopener noreferrer"}},[s._v("backlog参数对TCP连接建立的影响"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://blog.csdn.net/jacolin/article/details/47134895",target:"_blank",rel:"noopener noreferrer"}},[s._v("archlinux开机自启动优化"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"http://i.lckiss.com/?p=1623",target:"_blank",rel:"noopener noreferrer"}},[s._v("Arch linux Systemd自启动脚本的使用"),a("OutboundLink")],1)])])]),s._v(" "),a("h2",{attrs:{id:"有防必先攻-有攻才有防"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#有防必先攻-有攻才有防"}},[s._v("#")]),s._v(" 有防必先攻，有攻才有防")]),s._v(" "),a("p",[s._v("黑客通常会以下列的方式入侵系统：")]),s._v(" "),a("details",{staticClass:"custom-block details"},[a("summary",[s._v("入侵方法")]),s._v(" "),a("ol",[a("li",[s._v("直接窃听取得root密码，或者取得某位特殊User的密码，而该位User可能为root，再获取任意一位User的密码，因为取得一般用户密码通常很容易。")]),s._v(" "),a("li",[s._v("黑客们经常用一些常用字来破解密码。曾经有一位美国黑客表示，只要用“password”这个字，就可以打开全美多数的计算机。其它常用的单词还有：account、ald、alpha、beta、computer、dead、demo、dollar、games、bod、hello、help、intro、kill、love、no、ok、okay、please、sex、secret、superuser、system、test、work、yes等。")]),s._v(" "),a("li",[s._v("使用命令：finger@some.cracked.host，就可以知道该台计算机上面的用户名称。然后找这些用户下手，并通过这些容易入侵的用户取得系统的密码文件/etc/passwd，再用密码字典文件搭配密码猜测工具猜出root的密码。")]),s._v(" "),a("li",[s._v("利用一般用户在/tmp目录放置着的SetUID的文件或者执行着SetUID程序，让root去执行，以产生安全漏洞。")]),s._v(" "),a("li",[s._v("利用系统上需要SetUID root权限的程序的安全漏洞，取得root的权限，例如:pppd。")]),s._v(" "),a("li",[s._v("从.rhost的主机入侵。因为当用户执行rlogin登录时，rlogin程序会锁定.rhost定义的主机及账号，并且不需要密码登录。")]),s._v(" "),a("li",[s._v("修改用户的.login、cshrc、.profile等Shell设置文件，加入一些破坏程序。用户只要登录就会执行，例如"),a("code",[s._v("if tmp/backdoor exists run tmp/backdoor")]),s._v("。")]),s._v(" "),a("li",[s._v("只要用户登录系统，就会不知不觉地执行Backdoor程序（可能是Crack程序），它会破坏系统或者提供更进一步的系统信息，以利Hacker渗透系统。")]),s._v(" "),a("li",[s._v("如果公司的重要主机可能有网络防火墙的层层防护，Hacker有时先找该子网的任何一台容易入侵的主机下手，再慢慢向重要主机伸出魔掌。例如：使用NIS共同联机，可以利用"),a("code",[s._v("remote")]),s._v("命令不需要密码即可登录等，这样黑客就很容易得手了。")]),s._v(" "),a("li",[s._v("Hacker会通过中间主机联机，再寻找攻击目标，避免被用逆查法抓到其所在的真正IP地址。")]),s._v(" "),a("li",[s._v("Hacker进入主机有好几种方式，可以经由Telnet（Port 23）、Sendmail（Port25）、FTP（Port 21）或WWW（Port 80）的方式进入。一台主机虽然只有一个地址，但是它可能同时进行多项服务，而这些Port都是黑客进入该主机很好的方式。")]),s._v(" "),a("li",[s._v("Hacker通常利用NIS（IP）、NFS这些RPC Service截获信息。只要通过简单的命令（例如"),a("code",[s._v("showmount")]),s._v("），便能让远方的主机自动报告它所提供的服务。当这些信息被截获时，即使装有tcp_wrapper等安全防护软件，管理员依然会在毫不知情的情况下被借用了NIS Server上的文件系统，而导致/etc/passwd外流。")]),s._v(" "),a("li",[s._v("发E-mail给anonymous账号，从FTP站取得/etc/passwd密码文件，或直接下载FTP站/etc目录的passwd文件。")]),s._v(" "),a("li",[s._v("网络窃听，使用sniffer程序监视网络Packet，捕捉Telnet，FTP和Rlogin一开始的会话信息，便可顺手截获root密码，所以sniffer是造成今日Internet非法入侵的主要原因之一。")]),s._v(" "),a("li",[s._v("利用一些系统安全漏洞入侵主机，例如：Sendmail、Imapd、Pop3d、DNS等程序，经常发现安全漏洞，这对于入侵不勤于修补系统漏洞的主机相当容易得手。")]),s._v(" "),a("li",[s._v("被Hacker入侵计算机，系统的Telnet程序可能被掉包，所有用户Telnet session的账号和密码均被记录下，并发E-mail给Hacker，进行更进一步的入侵。")]),s._v(" "),a("li",[s._v("Hacker会清除系统记录。一些厉害的Hacker都会把记录它们进入的时间、IP地址消除掉，诸如清除：syslog、lastlog、messages、wtmp、utmp的内容，以及Shell历史文件.history。")]),s._v(" "),a("li",[s._v("入侵者经常将如"),a("code",[s._v("ifconfig")]),s._v("、"),a("code",[s._v("tcpdump")]),s._v("这类的检查命令更换，以避免被发觉。")]),s._v(" "),a("li",[s._v("系统家贼偷偷复制/etc/passwd，然后利用字典文件去解密码。")]),s._v(" "),a("li",[s._v("家贼通过su或sudo之类的Super User程序觊觎root的权限。")]),s._v(" "),a("li",[s._v("黑客经常使用Buffer overflow（缓冲区溢位）手动入侵系统。")]),s._v(" "),a("li",[s._v("cron是Linux操作系统用来自动执行命令的工具，如定时备份或删除过期文件等等。入侵者常会用cron来留后门，除了可以定时执行破译码来入侵系统外，又可避免被管理员发现的危险。")]),s._v(" "),a("li",[s._v("利用IP spoof（IP诈骗）技术入侵Linux主机。")])])]),s._v(" "),a("h2",{attrs:{id:"布线设防的宏观理念"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#布线设防的宏观理念"}},[s._v("#")]),s._v(" 布线设防的宏观理念")]),s._v(" "),a("p",[s._v("如果能采用以上方式入侵你的电脑，这已经说明当前电脑的安全性十分令人担忧。但我们不是一点办法都没有，而要未雨绸缪，做好日常的安全防护军备：")]),s._v(" "),a("ol",[a("li",[s._v("提前关闭所有可能的系统后门，以防止入侵者利用系统中的漏洞入侵。例如用"),a("code",[s._v("rpcinfo -p")]),s._v("来检查机器上是否运行了一些不必要的远程服务。一旦发现，立即停掉，以免给非法用户留下系统的后门。")]),s._v(" "),a("li",[s._v("确认系统当中运行的是较新的Linux、Unix守护程序。因为老的守护程序允许其它机器远程运行一些非法的命令。")]),s._v(" "),a("li",[s._v("定期从操作系统生产商那里获得安全补丁程序。")]),s._v(" "),a("li",[s._v("安装加强系统安全的程序，如：Shadow password、TCP wrappet、SSH、PGP等。")]),s._v(" "),a("li",[s._v("可以搭建网络防火墙，防止网络受到攻击。")]),s._v(" "),a("li",[s._v("利用扫描工具对系统进行漏洞检测，来考验主机容易受攻击的程度。")]),s._v(" "),a("li",[s._v("多订阅一些安全通报，多访问安全站点，以获得及时的安全信息来修补系统软硬件的漏洞。")])]),s._v(" "),a("p",[s._v("设防的基本思路应该是都包含在内了，接着我们谈一下具体的做法。")]),s._v(" "),a("h2",{attrs:{id:"巡逻检查"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#巡逻检查"}},[s._v("#")]),s._v(" 巡逻检查")]),s._v(" "),a("h3",{attrs:{id:"充分利用linux和unix系统中内置的检查命令来检测系统"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#充分利用linux和unix系统中内置的检查命令来检测系统"}},[s._v("#")]),s._v(" 充分利用Linux和Unix系统中内置的检查命令来检测系统")]),s._v(" "),a("ul",[a("li",[s._v("使用"),a("code",[s._v("who")]),s._v("来查看谁登陆到系统中。")]),s._v(" "),a("li",[s._v("使用"),a("code",[s._v("w")]),s._v("来查看谁登陆到系统中，且在做什么操作。")]),s._v(" "),a("li",[s._v("使用"),a("code",[s._v("last")]),s._v("显示系统曾经被登陆的用户和ttys。")]),s._v(" "),a("li",[s._v("使用"),a("code",[s._v("history")]),s._v("显示系统过去被运行的命令。")]),s._v(" "),a("li",[s._v("使用"),a("code",[s._v("netstat")]),s._v("来查看现在的网络状态。")]),s._v(" "),a("li",[s._v("使用"),a("code",[s._v("top")]),s._v("动态实时查看系统进程。")]),s._v(" "),a("li",[s._v("使用"),a("code",[s._v("finger")]),s._v("查看所有的登陆用户。")])]),s._v(" "),a("h3",{attrs:{id:"定期检查系统中的日志、文件、时间和进程信息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#定期检查系统中的日志、文件、时间和进程信息"}},[s._v("#")]),s._v(" 定期检查系统中的日志、文件、时间和进程信息")]),s._v(" "),a("ul",[a("li",[s._v("检查"),a("code",[s._v("/var/log/messages")]),s._v("日志文件查看外部用户的登陆状况。")]),s._v(" "),a("li",[s._v("检查用户目录下"),a("code",[s._v("/home/username")]),s._v("下的登陆历史文件(如：.history 文件)。")]),s._v(" "),a("li",[s._v("检查用户目录下"),a("code",[s._v("/home/username")]),s._v("的"),a("code",[s._v(".rhosts")]),s._v("、"),a("code",[s._v(".forward")]),s._v("远程登陆文件。")]),s._v(" "),a("li",[s._v("用"),a("code",[s._v("find / -ctime -2 -ctime +1 -ls")]),s._v("命令来查看不到两天以内修改的一些文件。")]),s._v(" "),a("li",[s._v("用"),a("code",[s._v("ls -lac")]),s._v("命令去查看文件真正的修改时间。")]),s._v(" "),a("li",[s._v("用"),a("code",[s._v("cmp file1 file2")]),s._v("命令来比较文件大小的变化。")]),s._v(" "),a("li",[s._v("用"),a("code",[s._v("ps -ef")]),s._v("查看进程，需要注意UID为0的进程。")]),s._v(" "),a("li",[s._v("用"),a("code",[s._v("lsof -p [pid]")]),s._v("来查看"),a("code",[s._v("[pid]")]),s._v("进程所打开的端口和文件。")]),s._v(" "),a("li",[s._v("通过比较差异"),a("code",[s._v("ps -ef | awk '{print $2}'| sort -n | uniq >1;ls /proc |sort -n|uniq >2;diff 1 2")]),s._v("来检查隐藏进程。")]),s._v(" "),a("li",[s._v("用"),a("code",[s._v("ifconfig")]),s._v("查看往外发包量。")]),s._v(" "),a("li",[s._v("使用"),a("code",[s._v("nethogs")]),s._v("来检测系统进程占用带宽情况，也可用"),a("code",[s._v("nethogs <网卡设备>")]),s._v("来指定网卡设备。")]),s._v(" "),a("li",[s._v("用"),a("code",[s._v('ss -anp |grep ":80"')]),s._v("来查找访问外网80端口的进程。")])]),s._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[s._v("注意")]),s._v(" "),a("p",[s._v("为了保证系统的绝对安全，除了做好预防和进行安全检查工作外，还要养成一个保证系统、网络安全的好习惯：定期定时做好完整的数据备份。有了完整的数据备份，在遭到攻击或系统出现故障时也能迅速恢复系统。")])]),s._v(" "),a("h3",{attrs:{id:"检查网络"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#检查网络"}},[s._v("#")]),s._v(" 检查网络")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("link")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" PROMISC "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 正常网卡不该在promisc混杂模式，可能存在sniffer")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("lsof")]),s._v(" –i "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看所有使用开放端口的进程")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("lsof")]),s._v(" –i :80 "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看所有使用开放端口80的进程")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("### 两者都是查看非正常打开的TCP/UDP端口")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("netstat")]),s._v(" -anp\nss -anp\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("###")]),s._v("\n\narp -a "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 显示本机的arp(地址解析协议)缓冲区内容")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("h3",{attrs:{id:"检查系统计划任务、系统服务及开机启动项"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#检查系统计划任务、系统服务及开机启动项"}},[s._v("#")]),s._v(" 检查系统计划任务、系统服务及开机启动项")]),s._v(" "),a("p",[s._v("有些病毒也可能会通过系统计划任务来静默隐藏运行：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("crontab")]),s._v(" -u root -l\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /etc/crontab \n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" -al /etc/cron.*\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" -al /var/spool/cron/ \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("一些病毒也会自己创建相应的服务、开机启动项来添加，因此要查看开机自启动的服务：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("systemd-analyze blame "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看开机启动项和启动时间")]),s._v("\nsystemctl --all "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" not-found "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看出错启动项")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" -l /etc/systemd/system "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 检查该目录下的service文件")]),s._v("\nsystemctl status "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 检查系统内正在运行的服务")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果确认出错启动项无异常并且想解决掉出错启动项的话，可以执行这个：")]),s._v("\nsystemctl mask plymouth-start.service\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看开机启动时间可以用这个")]),s._v("\nsystemd-analyze\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("h2",{attrs:{id:"安全防线加强巩固"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安全防线加强巩固"}},[s._v("#")]),s._v(" 安全防线加强巩固")]),s._v(" "),a("h3",{attrs:{id:"物理层面的安全问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#物理层面的安全问题"}},[s._v("#")]),s._v(" 物理层面的安全问题")]),s._v(" "),a("p",[s._v("硬件服务器，首先得专业人的来做专业的维护。其次就是关闭从CD/DVD等这些方面的软启动方式。同时也可以设置BIOS密码，并且要有限制访问的策略与各类流程管控。")]),s._v(" "),a("p",[s._v("还可以禁用USB设备来达到安全的目的，方法如下：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/modprobe.d/stopusb\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("并向其中写入"),a("code",[s._v("install usb-storage /bin/true")]),s._v("。")]),s._v(" "),a("p",[s._v("还有另外的方式，不过不建议采用：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" /lib/modules/"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("KernelVersion"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("/kernel/drivers/usb/storage/usb-storage.ko.zst /lib/modules/"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("KernelVersion"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("/kernel/drivers/usb/storage/usb-storage.ko.zst.backup\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"系统版本相关的安全问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#系统版本相关的安全问题"}},[s._v("#")]),s._v(" 系统版本相关的安全问题")]),s._v(" "),a("p",[s._v("要常做系统更新，及时下载安装更新补丁，要保证已经有的漏洞要及时的修复，系统内无其它漏洞存在。还要保证系统包含了最新版本的补丁、安全修复和可用内核。")]),s._v(" "),a("h3",{attrs:{id:"软件应用相关的安全问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#软件应用相关的安全问题"}},[s._v("#")]),s._v(" 软件应用相关的安全问题")]),s._v(" "),a("p",[s._v("不论安装系统还是安装常用软件，请遵循最小化处理原则。因为软件越多，也意味着潜在的漏洞越多。")]),s._v(" "),a("p",[s._v("对于一些不必要开放的系统服务及端口，建议关闭：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chkconfig")]),s._v(" --list "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 用于查看当前开放的服务与端口")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chkconfig")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("ServerName"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" off "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 用于关闭端口")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("然后当我尝试使用的时候发现系统没有"),a("code",[s._v("chkconfig")]),s._v("命令。相应地在现在基于"),a("code",[s._v("systemctl")]),s._v("命令管理系统进程及服务的Linux系统应该使用以下命令来代替：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("systemctl -a "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 用于查看当前所有的服务进程")]),s._v("\nsystemctl stop "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("ServerName"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 用于终止服务进程运行")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("另外还要检查命令是否被篡改：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" -l  /usr/bin/which\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" -l "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("which")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("find")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("find")]),s._v(" /usr/ -mtime -20 -ls\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("find")]),s._v(" /bin/ /sbin/ /usr/bin/ /usr/sbin/ /usr/local/bin/ /usr/local/sbin/ -mtime -20 -ls\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h3",{attrs:{id:"ssh远程连接相关的安全问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ssh远程连接相关的安全问题"}},[s._v("#")]),s._v(" SSH远程连接相关的安全问题")]),s._v(" "),a("p",[s._v("非必要情况下不能允许使用root用户远程登录，root具有系统的最高权限，如果允许的话就会存在将最高权限暴露给他人的风险。因此我们需要修改SSH的配置文件"),a("code",[s._v("/etc/ssh/sshd_config")]),s._v("，将其中的"),a("code",[s._v("PermitRootLogin")]),s._v("字段修改为"),a("code",[s._v("no")]),s._v("，如果有需要，可以根据实际情况修改"),a("code",[s._v("Port")]),s._v("属性（表示端口号）、"),a("code",[s._v("PermitEmptyPasswords")]),s._v("属性（表示是否允许密码为空）、"),a("code",[s._v("AllowUsers")]),s._v("属性（表示允许使用SSH协议进行远程连接的用户）、"),a("code",[s._v("DenyUsers")]),s._v("属性（表示拒绝后面所有用户的SSH连接）等。")]),s._v(" "),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[s._v("注意")]),s._v(" "),a("p",[s._v("重启"),a("code",[s._v("sshd")]),s._v("服务后修改的所有属性才能生效。\n执行：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl restart sshd\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])]),s._v(" "),a("h3",{attrs:{id:"用户管理相关的安全问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#用户管理相关的安全问题"}},[s._v("#")]),s._v(" 用户管理相关的安全问题")]),s._v(" "),a("ol",[a("li",[s._v("使用"),a("code",[s._v("passwd")]),s._v("命令来管理用户的密码。")]),s._v(" "),a("li",[s._v("使用"),a("code",[s._v("userdel")]),s._v("命令删除不需要的用户。")]),s._v(" "),a("li",[s._v("使用"),a("code",[s._v("usermod -L")]),s._v("命令来锁定用户的属性，如需要解锁的话使用"),a("code",[s._v("usermod -U")]),s._v("命令即可。")]),s._v(" "),a("li",[a("code",[s._v("cat /etc/passwd")]),s._v("可以用来查看是否有异常的系统用户。")]),s._v(" "),a("li",[a("code",[s._v("awk -F\":\" '{if($3 == 0){print $1}}' /etc/passwd")]),s._v("可以用来查看所有的特权用户，特别关注一下是否产生了新用户。")])]),s._v(" "),a("h4",{attrs:{id:"设置只允许该组账号使用su命令切换至root用户"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#设置只允许该组账号使用su命令切换至root用户"}},[s._v("#")]),s._v(" 设置只允许该组账号使用"),a("code",[s._v("su")]),s._v("命令切换至root用户：")]),s._v(" "),a("p",[s._v("我们要实现这个功能的话需要修改"),a("code",[s._v("/etc/pam.d/su")]),s._v("文件来做配置。")]),s._v(" "),a("p",[s._v("这里特别介绍一下该文件中这三项的理解：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("auth        [success=2 default=ignore] pam_succeed_if.so use_uid user notingroup <group_name>\nauth        required pam_wheel.so use_uid group=<group_name>\nauth        required pam_listfile.so item=user sense=allow onerr=fail file=/etc/security/<file_with_allowed_target_UIDs>\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[s._v("透析详解")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("auth        required pam_wheel.so use_uid group=<group_name>\nauth        required pam_listfile.so item=user sense=allow onerr=fail file=/etc/security/<file_with_allowed_target_UIDs>\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("这里要配置的属性应该是两个都要一起配置。")]),s._v(" "),a("p",[s._v("配置信息描述的操作是：验证用户是否在"),a("code",[s._v("<group_name>")]),s._v("中，并且是否也在文件"),a("code",[s._v("/etc/security/<file_with_allowed_target_UIDs>")]),s._v("中列出，只有都满足的情况下，该用户才能使用"),a("code",[s._v("su")]),s._v("命令来登录root用户。")]),s._v(" "),a("p",[a("strong",[s._v("注意")]),s._v("：文件"),a("code",[s._v("/etc/security/<file_with_allowed_target_UIDs>")]),s._v("不应该是全局可写，推荐配置成只有root可读可写，其他人只有可读权限，文件所有者和所在组都改为"),a("code",[s._v("root")]),s._v("。该文件下记录的是一些用户的UID，每行对应一个用户UID。")]),s._v(" "),a("p",[s._v("如果发现所属或权限不满足要求，执行以下命令修改权限即可：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" root:root /etc/security/"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("file_with_allowed_target_UIDs"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" 0644 /etc/security/"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("file_with_allowed_target_UIDs"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("执行之后可以使用"),a("code",[s._v("ls -lh")]),s._v("来检查权限信息：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("❯ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" -lh /etc/security/"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("file_with_allowed_target_UIDs"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n-rw-r--r--. "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" Apr "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(":19 /etc/security/"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("file_with_allowed_target_UIDs"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("hr"),s._v(" "),a("p",[s._v("如果在实际中发现以上配置方式还是无法满足一些要求的话，还有以下的信息配置进行更多的细粒化验证：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("auth        [success=2 default=ignore] pam_succeed_if.so use_uid ......\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("strong",[s._v("有关功能、作用和文件的描述如下")]),s._v("：")]),s._v(" "),a("p",[a("code",[s._v("pam_succeed_if.so")]),s._v("设计为根据要验证的用户所属帐户的Feature或其他PAM项的值来成功或失败进行身份验证，另外有一种用途是根据此测试选择是否加载其他模块。")]),s._v(" "),a("blockquote",[a("p",[a("strong",[s._v("注意")]),s._v("：应该给模块一个或多个条件作为模块参数，并且只有满足所有条件，身份验证才会成功，这时用户才能正常登录。")])]),s._v(" "),a("p",[a("code",[s._v("pam_succeed_if.so")]),s._v("后续的内容被这样定义：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("pam_succeed_if.so [flag...] [condition...]\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("details",[a("summary",[s._v("flag参数的可选项")]),s._v(" "),a("p",[a("strong",[s._v("debug")]),s._v("：Turns on debugging messages sent to syslog.")]),s._v(" "),a("p",[a("strong",[s._v("use_uid")]),s._v("：Evaluate conditions using the account of the user whose UID the application is running under instead of the user being authenticated.")]),s._v(" "),a("p",[a("strong",[s._v("quiet")]),s._v("：Don't log failure or success to the system log.")]),s._v(" "),a("p",[a("strong",[s._v("quiet_fail")]),s._v("：Don't log failure to the system log.")]),s._v(" "),a("p",[a("strong",[s._v("quiet_success")]),s._v("：Don't log success to the system log.")])]),s._v(" "),a("details",[a("summary",[s._v("Condition参数的详情")]),s._v(" "),a("p",[s._v("Conditions are three words: a field，a test，and a value to test for. Available fields are user，uid，gid，shell，home and service:")]),s._v(" "),a("p",[a("strong",[s._v("field < number")]),s._v(": Field has a value numerically less than number.")]),s._v(" "),a("p",[a("strong",[s._v("field <= number")]),s._v(": Field has a value numerically less than or equal to number.")]),s._v(" "),a("p",[a("strong",[s._v("field eq number")]),s._v(": Field has a value numerically equal to number.")]),s._v(" "),a("p",[a("strong",[s._v("field >= number")]),s._v(": Field has a value numerically greater than or equal to number.")]),s._v(" "),a("p",[a("strong",[s._v("field > number")]),s._v(": Field has a value numerically greater than number.")]),s._v(" "),a("p",[a("strong",[s._v("field ne number")]),s._v(": Field has a value numerically different from number.")]),s._v(" "),a("p",[a("strong",[s._v("field = string")]),s._v(": Field exactly matches the given string.")]),s._v(" "),a("p",[a("strong",[s._v("field != string")]),s._v(": Field does not match the given string.")]),s._v(" "),a("p",[a("strong",[s._v("field =~ glob")]),s._v(": Field matches the given glob.\n"),a("strong",[s._v("field !~ glob")]),s._v(": Field does not match the give\nn glob.")]),s._v(" "),a("p",[a("strong",[s._v("field in item:item:... ")]),s._v(": Field is contained in the list of items separated by colons.")]),s._v(" "),a("p",[a("strong",[s._v("field notin item:item:... ")]),s._v(": Field is not contained in the list of items separated\nby colons.\n"),a("strong",[s._v("user ingroup group")]),s._v(": User is in given group.\n"),a("strong",[s._v("user notingroup group")]),s._v(": User is not in given\ngroup.")]),s._v(" "),a("p",[a("strong",[s._v("user innetgr netgroup")]),s._v(": (user，host) is in given netgroup.")]),s._v(" "),a("p",[a("strong",[s._v("user notinnetgr group")]),s._v(": (user，host) is not in given netgroup.")])])]),s._v(" "),a("h4",{attrs:{id:"修改用户的密码策略"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修改用户的密码策略"}},[s._v("#")]),s._v(" 修改用户的密码策略")]),s._v(" "),a("p",[s._v("对于一个庞大的组织来说，多人共用服务器必然存在安全隐患，我们可以通过设置用户的密码策略来提高系统安全性，降低风险。我们通过修改文件"),a("code",[s._v("/etc/login.defs")]),s._v("来配置密码策略。")]),s._v(" "),a("p",[s._v("文件里也写了它的功能与规范要求：")]),s._v(" "),a("blockquote",[a("p",[s._v("/etc/login.defs - Configuration control definitions for the login package.")]),s._v(" "),a("p",[s._v("Three items must be defined:  MAIL_DIR，ENV_SUPATH，and ENV_PATH.\nIf unspecified，some arbitrary (and possibly incorrect) value will\nbe assumed.  All other items are optional - if not specified then\nthe described action or option will be inhibited.")]),s._v(" "),a("p",[s._v('Comment lines (lines beginning with "#") and blank lines are ignored.')]),s._v(" "),a("p",[s._v("Modified for Linux.  --marekm")])]),s._v(" "),a("p",[s._v("文件里写的内容相当全面详细，各参数的作用都已在上放写好，因此需要修改的时候看注释就好，这里只放出来一个例子：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Delay in seconds before being allowed another attempt after a login failure")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\nFAIL_DELAY\t\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("这里在说"),a("code",[s._v("FAIL_DELAY")]),s._v("变量决定了在用户登录失败的时候需要等待"),a("code",[s._v("FAIL_DELAY")]),s._v("时间长度后才能进行下一次登录请求。")]),s._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[s._v("通过该文件设置su权限")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"SU_WHEEL_ONLY yes"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" /etc/login.defs\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("通过这个命令来设置参数"),a("code",[s._v("SU_WHEEL_ONLY")]),s._v("，表示只有wheel用户组才能使用"),a("code",[s._v("su")]),s._v("命令切换至root。")])]),s._v(" "),a("h3",{attrs:{id:"文件管理相关的安全问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#文件管理相关的安全问题"}},[s._v("#")]),s._v(" 文件管理相关的安全问题")]),s._v(" "),a("p",[s._v("建议"),a("code",[s._v("/etc/passwd")]),s._v("和"),a("code",[s._v("/etc/shadow")]),s._v("两个文件都要限定锁死，只限root管理员能查看。并且平日注意防止该类文件外泄。")]),s._v(" "),a("p",[s._v("联系之前我写的"),a("RouterLink",{attrs:{to:"/Linux/UUA.html"}},[s._v("笔记")]),s._v("，就可以知道还能另外设置特殊权限，执行以下指令来保证文件不可更改：")],1),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("chattr +i /etc/passwd\nchattr +i /etc/shadow\nchattr +i /etc/group\nchattr +i /etc/gshadow\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("时常关注文件修改时间也是必要的操作，查看修改时间可以使用"),a("code",[s._v("ls -l")]),s._v("命令，如：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" -l /etc/passwd\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"禁用快捷键重启的安全问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#禁用快捷键重启的安全问题"}},[s._v("#")]),s._v(" 禁用快捷键重启的安全问题")]),s._v(" "),a("p",[s._v("在使用Linux系统中，按下"),a("kbd",[s._v("Ctrl")]),s._v("+"),a("kbd",[s._v("Alt")]),s._v("+"),a("kbd",[s._v("Del")]),s._v("会触发重启事件，在一些情况下可能会产生不良影响甚至会带来不小的损失，因此需要考虑禁用这一组危险的快捷键。")]),s._v(" "),a("p",[s._v("但应该注意到，这个快捷键其实是让systemd来按照"),a("code",[s._v("ctrl-alt-del.target")]),s._v("的文件配置进行活动的，而该文件的性质其实是一个软链接：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("❯ ll /usr/lib/systemd/system/ctrl-alt-del.target\nlrwxrwxrwx "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("月 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(" 03:24 /usr/lib/systemd/system/ctrl-alt-del.target -"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" reboot.target\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("因此如果尝试直接去修改这个文件的话，实际上改动的是reboot.target文件，这样可能会导致reboot命令不能正常执行甚至直接失效。所以我们应该改的是这个软链接，做法也比较简单，只需要将这个软链接重命名为其他名称即可（最好是能方便自己直接还原的名称）。")]),s._v(" "),a("h3",{attrs:{id:"监控用户行为相关的安全问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#监控用户行为相关的安全问题"}},[s._v("#")]),s._v(" 监控用户行为相关的安全问题")]),s._v(" "),a("p",[s._v("如果有需要监视用户的具体活动的话，需要安装工具"),a("code",[s._v("acct")]),s._v("，如果是使用yum包管理器的话可以"),a("code",[s._v("psacct")]),s._v("和"),a("code",[s._v("acct")]),s._v("二选一；如果是Arch系的Linux则需要从AUR源下载"),a("code",[s._v("acct")]),s._v("工具。接着这个工具的相关简单使用如下：")]),s._v(" "),a("ol",[a("li",[a("strong",[a("code",[s._v("ac")]),s._v("系列")]),s._v("：")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("ac "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#显示所有用户连接总时间")]),s._v("\nac -p "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#显示每个用户连接时间")]),s._v("\nac -d "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#显示每天所有用户连接总时间")]),s._v("\nac silence "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#显示指定用户连接时间")]),s._v("\nac -d silence "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#显示指定用户每天连接时间")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("ol",{attrs:{start:"2"}},[a("li",[a("strong",[a("code",[s._v("sa")]),s._v("系列")]),s._v("：")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("sa 输出用户活动信息\nsa "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#显示所有用户执行命令情况")]),s._v("\nsa -u "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#按用户显示执行命令情况")]),s._v("\nsa -m "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#按进程显示执行命令情况")]),s._v("\nsa -p "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#按使用率显示执行命令情况")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("ol",{attrs:{start:"3"}},[a("li",[a("strong",[a("code",[s._v("lastcomm")]),s._v("系列")]),s._v("：")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("lastcomm "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#输出最近执行命令信息")]),s._v("\nlastcomm "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#显示所有执行命令")]),s._v("\nlastcomm silence "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#显示指定用户执行命令")]),s._v("\nlastcomm "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#显示指定命令执行情况")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("ol",{attrs:{start:"4"}},[a("li",[a("strong",[s._v("其他")]),s._v("：")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("last "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看最近用户登录成功列表")]),s._v("\nlast -x "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#显示系统关机、重新开启等信息")]),s._v("\nlast -a "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#将IP显示在最后一列")]),s._v("\nlast -d "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#对IP进行域名解析")]),s._v("\nlast -R "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#不显示IP列")]),s._v("\nlast -n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#显示最近3条")]),s._v("\nlast "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{print $3}'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sort")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("uniq")]),s._v(" -c"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sort")]),s._v(" -grk "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#最近登陆成功次数最多的IP")]),s._v("\nlastb "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看最近用户登录失败的列表")]),s._v("\nlastb root "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{print $3}'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sort")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("uniq")]),s._v(" -c "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sort")]),s._v(" -nr"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("more")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#检查系统错误登陆日志，统计IP重试次数")]),s._v("\nlastlog "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看每个用户最后一次登陆的时间")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" -i Accepted /var/log/secure "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查找远程登录成功的IP")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" -i Accepted /var/log/secure "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{print $9,$11}'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sort")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("uniq")]),s._v(" -c "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sort")]),s._v(" -grk "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查找远程登录成功的IP")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("h3",{attrs:{id:"日志相关的安全问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#日志相关的安全问题"}},[s._v("#")]),s._v(" 日志相关的安全问题")]),s._v(" "),a("p",[s._v("定期检查日志文件是一件必要的事，这样也方便你第一时间掌握一些情况，在CentOS Linux中以下常用的日志文件的功能如表所示：")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"center"}},[s._v("日志文件")]),s._v(" "),a("th",{staticStyle:{"text-align":"center"}},[s._v("作用")])])]),s._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"center"}},[a("code",[s._v("/var/log/message")])]),s._v(" "),a("td",{staticStyle:{"text-align":"center"}},[s._v("记录系统日志或当前活动日志")])]),s._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[a("code",[s._v("/var/log/auth.log")])]),s._v(" "),a("td",{staticStyle:{"text-align":"center"}},[s._v("身份认证日志")])]),s._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[a("code",[s._v("/var/log/kern.log")])]),s._v(" "),a("td",{staticStyle:{"text-align":"center"}},[s._v("内核日志")])]),s._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[a("code",[s._v("/var/log/cron.log")])]),s._v(" "),a("td",{staticStyle:{"text-align":"center"}},[s._v("Crond日志，cron任务")])]),s._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[a("code",[s._v("/var/log/maillog")])]),s._v(" "),a("td",{staticStyle:{"text-align":"center"}},[s._v("邮件服务器日志")])]),s._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[a("code",[s._v("/var/log/boot.log")])]),s._v(" "),a("td",{staticStyle:{"text-align":"center"}},[s._v("系统启动日志")])]),s._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[a("code",[s._v("/var/log/mysqld.log")])]),s._v(" "),a("td",{staticStyle:{"text-align":"center"}},[s._v("MySQL数据库服务器日志")])]),s._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[a("code",[s._v("/var/log/secure")])]),s._v(" "),a("td",{staticStyle:{"text-align":"center"}},[s._v("认证日志")])]),s._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[a("code",[s._v("/var/log/utmp")]),s._v("或"),a("code",[s._v("/var/log/wtmp")])]),s._v(" "),a("td",{staticStyle:{"text-align":"center"}},[s._v("登录日志")])]),s._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[a("code",[s._v("/var/log/yum.log")])]),s._v(" "),a("td",{staticStyle:{"text-align":"center"}},[s._v("Yum日志")])])])]),s._v(" "),a("h3",{attrs:{id:"安全工具相关的安全问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安全工具相关的安全问题"}},[s._v("#")]),s._v(" 安全工具相关的安全问题")]),s._v(" "),a("p",[s._v("对于系统来说，常用的安全扫描工具是必备的，比如：扫描开放端口nmap。对于系统中的WEB应用等来说，可以使用一些开源的工具：IBM AppScan、SQL Map等。")]),s._v(" "),a("p",[s._v("Linux平台上还有杀毒软件ClamAV、rkhunter，方便病毒查杀。")]),s._v(" "),a("p",[s._v("此外CentOS还有"),a("code",[s._v("McAfee")]),s._v("、"),a("code",[s._v("sophos")]),s._v("等杀毒软件可以安装使用，这里就不详细记述了（主要是因为我使用Arco Linux）。")]),s._v(" "),a("h3",{attrs:{id:"管理方法相关的安全问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#管理方法相关的安全问题"}},[s._v("#")]),s._v(" 管理方法相关的安全问题")]),s._v(" "),a("p",[s._v("对于安全管理来说，好的流程与管理制度同样也是必须的，否则，谈上述各方面的作用基本为0，有方法，没有制度去让方法落地执行。")]),s._v(" "),a("p",[s._v("由于我没有在公司内待过，所以这一点也写不了什么。")]),s._v(" "),a("h2",{attrs:{id:"防火墙"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#防火墙"}},[s._v("#")]),s._v(" 防火墙")]),s._v(" "),a("p",[s._v("如果是在服务器上设置的话，需要先做好如下的准备工作：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("crontab")]),s._v(" -e\n*/10 * * * * root /etc/init.d/iptables stop\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("这里表示每十分钟就停止一次防火墙，这样就会避免因为误操作而将自己拒之门外的悲痛情况。")]),s._v(" "),a("p",[s._v("一般我们只需要采取以下策略来设置防火墙即可：")]),s._v(" "),a("ol",[a("li",[s._v("仅开放HTTP(80)、HTTPS(443)、SSH(自动捕获)端口，其他端口全部关闭，可以根据需要另外开放其它端口如FTP(21)端口、smtp(25)端口等，在下面的脚本中可以修改dport参数后面的端口列。")]),s._v(" "),a("li",[s._v("写如下脚本来单向禁止ping设置，这样外部IP就无法ping通你的服务器。"),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#!/bin/bash")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ssh_port")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("netstat")]),s._v(" -nutlp "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" sshd "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{print $4}'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cut")]),s._v(" -d "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('":"')]),s._v(" -f2"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("\n iptables -F\n iptables -F -t nat\n iptables -X\n iptables -P INPUT DROP\n iptables -P OUTPUT ACCEPT\n iptables -P FORWARD DROP\n iptables -A INPUT -i lo -j ACCEPT\n iptables -A INPUT -m state --state ESTABLISHED，RELATED -j ACCEPT\n iptables -A INPUT -p tcp -m multiport --dport "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("，443，"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$ssh_port")]),s._v(" -j ACCEPT\n iptables -A INPUT -p icmp --icmp-type "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" -j ACCEPT\n /etc/init.d/iptables save\n "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])])])]),s._v(" "),a("p",[s._v("最后记得取消掉任务计划服务"),a("code",[s._v("crontab")]),s._v("。")]),s._v(" "),a("h2",{attrs:{id:"检查异常系统文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#检查异常系统文件"}},[s._v("#")]),s._v(" 检查异常系统文件")]),s._v(" "),a("p",[a("strong",[s._v("注意SUID文件，可疑大于10M和空格文件")]),s._v("：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" -artl /tmp/\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("find")]),s._v(" / -uid "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" -perm "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4000")]),s._v(" -print\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("find")]),s._v(" / -size +10000k -print\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("find")]),s._v(" / -name "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"..."')]),s._v("  -print\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("find")]),s._v(" / -name "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('".."')]),s._v("  -print\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("find")]),s._v(" / -name "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"."')]),s._v("  -print\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("find")]),s._v(" / -name "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('" "')]),s._v("  -print\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[a("strong",[s._v("检查系统中的core文件")]),s._v("：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("find")]),s._v(" / -name core -exec "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" -l "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h2",{attrs:{id:"其他安全设置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#其他安全设置"}},[s._v("#")]),s._v(" 其他安全设置")]),s._v(" "),a("p",[a("strong",[s._v("开启")]),a("code",[s._v("TCP SYN Cookie")]),a("strong",[s._v("保护")]),s._v("：")]),s._v(" "),a("p",[s._v("执行"),a("code",[s._v("echo 1 > /proc/sys/net/ipv4/tcp_syncookies")]),s._v("即可开启。")]),s._v(" "),a("details",{staticClass:"custom-block details"},[a("summary",[s._v("TCP SYN Cookie的背景和Syn Flood攻击原理")]),s._v(" "),a("p",[s._v("正如有防必先有攻，我们需要先知道一种典型的DDos攻击：Syn Flood攻击。")]),s._v(" "),a("p",[s._v("Syn Flood攻击是基于TCP建立连接原理而进行的。TCP连接建立时，客户端通过发送SYN报文发起向处于监听状态的服务器发起连接，服务器为该连接分配一定的资源，并发送SYN和ACK报文。对服务器来说，此时该连接的状态称为半连接(Half-Open)，且仅当收到客户端回复的ACK报文后，连接才算建立完成。在这个过程中，如果服务器一直没有收到ACK报文(比如在链路中丢失了)，服务器会在超时后重传SYN和ACK。如果经过多次超时重传后，都没有收到，那么服务器会回收资源并关闭半连接。")]),s._v(" "),a("p",[s._v("在Unix/Linux系统中，监听是通过"),a("code",[s._v("listen")]),s._v("函数来完成的：")]),s._v(" "),a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("listen")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" sockfd，"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" backlog"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("第一个参数是设置的套接字，而第二个参数，《Unix网络编程》给出的描述是"),a("strong",[s._v("已完成的连接队列")]),s._v("(ESTABLISHED)与"),a("strong",[s._v("未完成连接队列")]),s._v("(SYN_RCVD)之和的上限。")]),s._v(" "),a("blockquote",[a("p",[s._v("一般我们将ESTABLISHED状态的连接称为全连接，而将SYN_RCVD状态的连接称为半连接")])]),s._v(" "),a("p",[s._v("虽然《Unix网络编程》这样给出描述，但实际上Linux内核中只有已完成连接队列实际存在，而未完成连接队列只有长度的记录。")]),s._v(" "),a("p",[s._v("每一个LISTEN状态的套接字都有一个"),a("code",[s._v("inet_connection_sock")]),s._v("结构，其中的"),a("code",[s._v("accept_queue")]),s._v("从名字上也可以看出就是已完成三次握手的子连接队列，另外这个结构里还记录了半连接请求的长度。以下是"),a("code",[s._v("inet_connection_sock")]),s._v("结构的定义：")]),s._v(" "),a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("inet_connection_sock")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("    \n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("request_sock_queue")]),s._v(" icsk_accept_queue"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("request_sock_queue")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("atomic_t")]),s._v(" qlen"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 半连接的长度")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("atomic_t")]),s._v(" young"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 一般情况，这个值 = qlen")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("request_sock")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("rskq_accept_head"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 已完成连接的队列头")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("request_sock")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("rskq_accept_tail"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 已完成连接的队列尾")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("p",[s._v("其中变量"),a("code",[s._v("young")]),s._v("比较关键，代码注释是这样解释的：")]),s._v(" "),a("blockquote",[a("p",[s._v("Normally all the openreqs are young and become mature(i.e. converted to established socket) for first timeout. If synack was not acknowledged for 1 second，it means one of the following things: synack was lost，ack was lost，rtt is high or nobody planned to ack (i.e. synflood).")])]),s._v(" "),a("p",[s._v("可以看得出来，当第一次出现"),a("code",[s._v("synack")]),s._v("或"),a("code",[s._v("ack")]),s._v("超时的时候，或者是"),a("code",[s._v("rtt")]),s._v("过高的时候，亦或者是根本没有人打算发送"),a("code",[s._v("ack")]),s._v("的时候（注意这里也指出了攻击类型Syn Flood），这些开放的请求就会被转换成全连接，这就是mature的含义。")]),s._v(" "),a("p",[s._v("而内核在关闭"),a("code",[s._v("syncookie")]),s._v("的情况下会这样处理SYN握手报文：")]),s._v(" "),a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tcp_conn_request")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("request_sock_ops")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("rsk_ops，\n             "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("tcp_request_sock_ops")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("af_ops，\n             "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("sock")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("sk，"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("sk_buff")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("skb"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 条件1: 半连接>=backlog")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("net"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v("ipv4"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sysctl_tcp_syncookies "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("inet_csk_reqsk_queue_is_full")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sk"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("isn"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("   \n        want_cookie "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tcp_syn_flood_action")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sk，skb，rsk_ops"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v("slab_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("want_cookie"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("goto")]),s._v(" drop"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" \n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 条件2: 全连接sock>backlog并且半连接队列的young字段>1")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sk_acceptq_is_full")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sk"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("inet_csk_reqsk_queue_young")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sk"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" \n        "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("NET_INC_STATS")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sock_net")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sk"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("，LINUX_MIB_LISTENOVERFLOWS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("goto")]),s._v(" drop"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" \n\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br")])]),a("p",[s._v("注意到"),a("code",[s._v("inet_csk_reqsk_queue_young(sk) > 1")]),s._v("这里表示网络繁忙导致"),a("code",[s._v("SYN ACK")]),s._v("丢失，但通常这个条件不会满足，一般client总会及时处理ACK的。因此如果发生丢弃SYN报文的话，只能是"),a("code",[s._v("(net->ipv4.sysctl_tcp_syncookies == 2 || inet_csk_reqsk_queue_is_full(sk)) && !isn")]),s._v("这里的条件为真，一般情况下"),a("code",[s._v("inet_csk_reqsk_queue_is_full(sk)")]),s._v("比较容易满足条件。")]),s._v(" "),a("p",[s._v("我们再看收到ACK报文时的处理：")]),s._v(" "),a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("sock")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tcp_v4_syn_recv_sock")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("sock")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("sk，\n                                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("sk_buff")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("skb，\n                                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("request_sock")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("req，\n                                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("dst_entry")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("dst，\n                                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("request_sock")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("req_unhash，\n                                bool "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("own_req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 全连接>backlog，就丢弃")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sk_acceptq_is_full")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sk"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("           \n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("goto")]),s._v(" exit_overflow"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 创建子套接字了")]),s._v("\n    newsk "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tcp_create_openreq_child")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sk，req，skb"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br")])]),a("p",[s._v("前面一些连接请求都可以顺利创建子连接，设此时全连接队列长度=backlog="),a("span",{staticClass:"katex"},[a("span",{staticClass:"katex-mathml"},[a("math",{attrs:{xmlns:"http://www.w3.org/1998/Math/MathML"}},[a("semantics",[a("mrow",[a("mi",[s._v("x")])],1),a("annotation",{attrs:{encoding:"application/x-tex"}},[s._v("x")])],1)],1)],1),a("span",{staticClass:"katex-html",attrs:{"aria-hidden":"true"}},[a("span",{staticClass:"base"},[a("span",{staticClass:"strut",staticStyle:{height:"0.43056em","vertical-align":"0em"}}),a("span",{staticClass:"mord mathnormal"},[s._v("x")])])])]),s._v("，半连接数目=0；")]),s._v(" "),a("p",[s._v("处理第"),a("span",{staticClass:"katex"},[a("span",{staticClass:"katex-mathml"},[a("math",{attrs:{xmlns:"http://www.w3.org/1998/Math/MathML"}},[a("semantics",[a("mrow",[a("mi",[s._v("x")]),a("mo",[s._v("+")]),a("mn",[s._v("1")])],1),a("annotation",{attrs:{encoding:"application/x-tex"}},[s._v("x+1")])],1)],1)],1),a("span",{staticClass:"katex-html",attrs:{"aria-hidden":"true"}},[a("span",{staticClass:"base"},[a("span",{staticClass:"strut",staticStyle:{height:"0.66666em","vertical-align":"-0.08333em"}}),a("span",{staticClass:"mord mathnormal"},[s._v("x")]),a("span",{staticClass:"mspace",staticStyle:{"margin-right":"0.2222222222222222em"}}),a("span",{staticClass:"mbin"},[s._v("+")]),a("span",{staticClass:"mspace",staticStyle:{"margin-right":"0.2222222222222222em"}})]),a("span",{staticClass:"base"},[a("span",{staticClass:"strut",staticStyle:{height:"0.64444em","vertical-align":"0em"}}),a("span",{staticClass:"mord"},[s._v("1")])])])]),s._v("个连接请求时，由于sk_acceptq_is_full的判断条件是"),a("code",[s._v(">")]),s._v("而不是"),a("code",[s._v(">=")]),s._v("，所以依然可以建立全连接。")]),s._v(" "),a("p",[s._v("而当第"),a("span",{staticClass:"katex-error",attrs:{title:"ParseError: KaTeX parse error: Undefined control sequence: \\， at position 2: k\\̲，̲(k>x+1)"}},[s._v("k\\，(k>x+1)")]),s._v("个连接请求到来时，由于半连接的数目还没有超过backlog，所以还是可以继续回复"),a("code",[s._v("SYNACK")]),s._v("，但收到ACK后已经不能再创建子套接字了，所以TCP状态依然为"),a("code",[s._v("SYN_RECV")]),s._v(".同时半连接的数目也会增加到backlog。")]),s._v(" "),a("p",[s._v("而对于客户端，它既然能收到SYNACK握手报文，那么就可以将TCP状态变为ESTABLISHED，当某一次再有握手请求到来时，由于半连接的数目已经达到backlog，因此，这个SYN报文会被丢弃。")]),s._v(" "),a("p",[s._v("这一切都说明了，服务器能保存的半连接的数量是有限的，因此当服务器遭遇大量攻击报文的时候，服务器将不再能够接受正常连接了，也就是服务不可用。")]),s._v(" "),a("p",[s._v("综上所述，我们已经深入理解了Syn Flood攻击了，自然也就明白应该如何防守——开启"),a("code",[s._v("TCP SYN Cookie")]),s._v("功能即可。")])]),s._v(" "),a("details",{staticClass:"custom-block details"},[a("summary",[s._v("TCP SYN Cookies原理")]),s._v(" "),a("blockquote",[a("p",[s._v("Syn Flood攻击成立的关键在于服务器资源是有限的，而服务器收到请求会分配资源。通常来说，服务器用这些资源保存此次请求的关键信息，包括请求的来源和目(五元组)，以及TCP选项，如最大报文段长度MSS、时间戳timestamp、选择应答使能Sack、窗口缩放因子Wscale等等。当后续的ACK报文到达，三次握手完成，新的连接创建，这些信息可以会被复制到连接结构中，用来指导后续的报文收发。")])]),s._v(" "),a("p",[s._v("Syn Cookies算法可以让服务器在不分配资源的情况下做到：")]),s._v(" "),a("ol",[a("li",[s._v("验证之后可能到达的ACK的有效性，保证这是一次完整的握手；")]),s._v(" "),a("li",[s._v("获得SYN报文中携带的TCP选项信息")])]),s._v(" "),a("p",[s._v("因为TCP连接建立时，双方的起始报文序号是可以任意的。而Syn Cookies利用这一点，按照如下规则构造初始序列号：")]),s._v(" "),a("ul",[a("li",[s._v("设t为一个缓慢增长的时间戳(典型实现是每64s递增一次)")]),s._v(" "),a("li",[s._v("设m为客户端发送的SYN报文中的MSS选项值")]),s._v(" "),a("li",[s._v("设s是连接的元组信息(源IP,目的IP,源端口，目的端口)和t经过密码学运算后的Hash值，即s=hash(sip,dip,sport,dport,t)，s的结果取低24位。")])]),s._v(" "),a("p",[s._v("那么初始序列号n的结构如下：")]),s._v(" "),a("ul",[a("li",[s._v("高5位为t mod 32")]),s._v(" "),a("li",[s._v("接下来3位为m的编码值")]),s._v(" "),a("li",[s._v("低24位为s")])]),s._v(" "),a("p",[s._v("当客户端收到此SYN和ACK报文后，根据TCP标准，它会回复ACK报文，且报文中ack = n + 1，那么在服务器收到它时，将ack - 1就可以拿回当初发送的SYN+ACK报文中的序号了！服务器巧妙地通过这种方式间接保存了一部分SYN报文的信息。")]),s._v(" "),a("p",[s._v("接下来，服务器需要对ack - 1这个序号进行检查：")]),s._v(" "),a("ul",[a("li",[s._v("将高5位表示的t与当前之间比较，看其到达地时间是否能接受。")]),s._v(" "),a("li",[s._v("根据t和连接元组重新计算s，看是否和低24位一致，若不一致，说明这个报文是被伪造的。")]),s._v(" "),a("li",[s._v("解码序号中隐藏的mss信息")])]),s._v(" "),a("p",[s._v("到此，连接就可以顺利建立了。")]),s._v(" "),a("p",[s._v("Linux的实现与上述有些区别：")]),s._v(" "),a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[s._v("seq "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("hash")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("saddr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" daddr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" sport"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" dport"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("th"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("seq "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" t "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("24")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("hash")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("saddr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" daddr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" sport"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" dport"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" mss_ind"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x00FFFFFF")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("其中，"),a("code",[s._v("req.th.seq")]),s._v("表示客户端的SYN报文中的序号，"),a("code",[s._v("mss_ind")]),s._v("是客户端通告的MSS值得编码，它的取值在比较新的内核中有4种(老的内核有8种), 分别对应以下4种值：")]),s._v(" "),a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" __u16 "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" msstab"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("536")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1300")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1440")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//1440, 1452: PPPoE")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1460")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])])]),s._v(" "),a("details",{staticClass:"custom-block details"},[a("summary",[s._v("Syn Cookies缺点与缺陷")]),s._v(" "),a("p",[s._v("其实使用Syn Cookies是有代价的：")]),s._v(" "),a("ol",[a("li",[s._v("MSS的编码只有3位，因此最多只能使用8种MSS值")]),s._v(" "),a("li",[s._v("服务器必须拒绝客户端SYN报文中的其他只在SYN和SYN+ACK中协商的选项，原因是服务器没有地方可以保存这些选项，比如Wscale和SACK")]),s._v(" "),a("li",[s._v("增加了密码学运算，增加了连接服务所需消耗的时间")])])]),s._v(" "),a("h2",{attrs:{id:"查杀异常进程命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查杀异常进程命令"}},[s._v("#")]),s._v(" 查杀异常进程命令")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("ps")]),s._v("、"),a("code",[s._v("top")]),s._v("、"),a("code",[s._v("htop")]),s._v("：查看运行的进程和进程系统资源占用情况，查找异常进程。")]),s._v(" "),a("li",[a("code",[s._v("pstree")]),s._v("：以树状图的形式显示进程间的关系。")]),s._v(" "),a("li",[a("code",[s._v("lsof")]),s._v("：可以查看进程打开的文件、文件或目录被哪个进程占用、打开某个端口的进程、系统所有打开的端口等等。")]),s._v(" "),a("li",[a("code",[s._v("netstat")]),s._v("：可以查看系统监听的所有端口、网络连接情况、查找连接数过多的IP地址等。")]),s._v(" "),a("li",[a("code",[s._v("ss")]),s._v("：与"),a("code",[s._v("lsof")]),s._v("、"),a("code",[s._v("netstat")]),s._v("等价。")]),s._v(" "),a("li",[a("code",[s._v("iftop")]),s._v("：监控TCP连接实时网络流量，可分别分析出入流量并进行排序，查找出流量异常的IP地址。（需要手动安装）")]),s._v(" "),a("li",[a("code",[s._v("nethogs")]),s._v("：监控每个进程使用的网络流量，并从高到低排序，方便查找出流量异常的进程。（需要手动安装）")]),s._v(" "),a("li",[a("code",[s._v("strace")]),s._v("：追踪一个进程所执行的系统调用。如已知PID可使用"),a("code",[s._v("strace -p <PID>")]),s._v("。")]),s._v(" "),a("li",[a("code",[s._v("strings")]),s._v("：输出文件中可打印的字符串。")])])])}),[],!1,null,null,null);t.default=n.exports}}]);